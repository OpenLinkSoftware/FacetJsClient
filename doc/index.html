<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Virtuoso Facet Service</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    <style>
      nav > h2 {
      /* display: none; */
      font-size: 95%;
      }
    </style>
</head>

<body>

<div id="main">

    <h1 class="page-title">Virtuoso Facet Service</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1>FacetJsClient - API</h1>
<p>2021-Feb-09<br>
CMSB</p>
<p>A Javascript client for the <a href="http://vos.openlinksw.com/owiki/wiki/VOS/VirtuosoFacetsWebService">Virtuoso Faceted Browsing Service</a>.</p>
<p>FacetJsClient is a Javascript interface to Virtuoso's /fct/service. It aims to be a client library with no UI dependencies with a view to it being usable by any UI framework. <a href="https://github.com/cblakeley/FacetReactClient">FacetReactClient</a> provides a React-based UI to the Virtuoso Faceted Browsing Service, using FacetJsClient for its underpinnings.</p>
<p>See also:</p>
<ul>
<li>Source code: <a href="https://github.com/cblakeley/FacetJsClient/tree/develop">GitHub: FacetJsClient</a></li>
</ul>
<h2>General Approach</h2>
<p>The client library includes two main classes: <code>FctQuery</code> and <code>FctResult</code>.</p>
<p><code>FctQuery</code> builds an XML request body for execution by <code>/fct/service</code>. The XML request payload is described by <a href="http://vos.openlinksw.com/owiki/wiki/VOS/VirtuosoFacetsWebService">Faceted Browsing Service</a>. Different elements and attributes of the XML payload are created, read, updated or deleted by various <code>FctQuery</code> methods and accessors. The general approach is to use JQuery for manipulating the input XML. To submit the XML request and execute the contained query, use <code>FctQuery#execute</code>. On successful execution, <code>FctQuery#execute</code> returns a <code>FctResult</code> object.</p>
<p><code>FctResult</code> holds the XML response in property <code>xml</code>. Rather than use JQuery to retrieve values from the XML, the response is also converted to a Javascript object using <a href="https://developer.mozilla.org/en-US/docs/Archive/JXON">JXON</a>, to allow for easy consumption by a JS client application. This Javascript object is accessible through property <code>json</code>. Different properties of the Javascript object, corresponding to different XML elements in the XML response, can be retrieved through various <code>FctResult</code> accessors.</p>
<p><code>FctQuery#execute</code> actually returns a Promise which, when fulfilled, returns a <code>FctResult</code>. To trigger <code>FctQuery#execute</code> from an event handler, use something like:</p>
<pre class="prettyprint source"><code>$('button').on('click', function() {
      fctQuery.execute()      
       .then(fctResult => {
         ... display the query result ...
       })
       .catch(err => {
         $('.fct_qry_status')
           .text('The Facet query failed: ' + err.message)
           .addClass('error');
       })
    })
</code></pre>
<h2>Sparql Query Generation</h2>
<p>Examples of Facet input XML and the corresponding generated SPARQL queries are shown below. Each nesting level in the input XML introduces a new SPARQL variable: <code>?s1</code>, <code>?s2</code> ... <code>?sN</code>, where N corresponds to the nesting level.</p>
<p><code>?s1</code> identifies the set of matching entities found by the faceted search. The other <code>?sN</code> (N &gt; 1) express the faceted search filter criteria, but aren't the primary entities being searched for.</p>
<h3>Example 1</h3>
<p><strong>Input XML</strong></p>
<pre class="prettyprint source"><code>&lt;?xml version=&quot;1.0&quot;?>
&lt;query xmlns=&quot;http://openlinksw.com/services/facets/1.0&quot;>
  &lt;!-- Nesting level 1: implied variable ?s1 -->
  &lt;class iri=&quot;http://xmlns.com/foaf/0.1/Person&quot; />
  &lt;property iri=&quot;http://xmlns.com/foaf/0.1/knows&quot;>
    &lt;-- Nesting level 2: Implied variable ?s2 -->
    &lt;property iri=&quot;http://xmlns.com/foaf/0.1/name&quot;>
       &lt;-- Nesting level 3: Implied variable ?s3 -->
      &lt;value>&quot;Kingsley Idehen&quot;&lt;/value>
    &lt;/property>
  &lt;/property>
  &lt;view type=&quot;list&quot; limit=&quot;100&quot; />
&lt;/query>
</code></pre>
<p><strong>Query meta graph</strong></p>
<p><img src="img/meta-graph-1.png" alt="meta-graph-1"></p>
<p><strong>Generated SPARQL query</strong></p>
<pre class="prettyprint source"><code>select ?s1 as ?c1  where  
{
  ?s1 a &lt;http://xmlns.com/foaf/0.1/Person> . 
  ?s1 &lt;http://xmlns.com/foaf/0.1/knows> ?s2 . 
  ?s2 &lt;http://xmlns.com/foaf/0.1/name> ?s3 . 
  filter (?s3 = &quot;Kingsley Idehen&quot;) . 
} 
group by (?s1) 
order by desc (&lt;LONG::IRI_RANK> (?s1))  
limit 100
</code></pre>
<h3>Example 2</h3>
<p><strong>Input XML</strong></p>
<pre class="prettyprint source"><code>&lt;?xml version=&quot;1.0&quot;?>
&lt;query xmlns=&quot;http://openlinksw.com/services/facets/1.0&quot;>
  &lt;!-- Nesting level 1: implied variable ?s1 -->
  &lt;class iri=&quot;http://xmlns.com/foaf/0.1/Person&quot; />
  &lt;property-of iri=&quot;http://xmlns.com/foaf/0.1/knows&quot;>	
    &lt;-- Nesting level 2: Implied variable ?s2 -->
    &lt;property iri=&quot;http://xmlns.com/foaf/0.1/name&quot;>	
      &lt;-- Nesting level 3: Implied variable ?s3 -->
      &lt;value>&quot;Melvin Carvalho&quot;&lt;/value>
    &lt;/property>
  &lt;/property-of>
  &lt;view type=&quot;list&quot; limit=&quot;100&quot; />
&lt;/query>
</code></pre>
<p><strong>Query meta graph</strong></p>
<p><img src="img/meta-graph-2.png" alt="meta-graph-2"></p>
<p><strong>Generated SPARQL query</strong></p>
<pre class="prettyprint source"><code>select ?s1 as ?c1
where
{
  ?s1 a &lt;http://xmlns.com/foaf/0.1/Person> . 
  ?s2 &lt;http://xmlns.com/foaf/0.1/knows> ?s1 . 
  ?s2 &lt;http://xmlns.com/foaf/0.1/name> ?s3 . 
  filter (?s3 = &quot;Melvin Carvalho&quot;) . 
} 
group by (?s1) 
order by desc (&lt;LONG::IRI_RANK> (?s1))  
limit 100
</code></pre>
<h3>Example 3</h3>
<p><strong>Input XML</strong></p>
<pre class="prettyprint source"><code>&lt;?xml version=&quot;1.0&quot;?>
&lt;query xmlns=&quot;http://openlinksw.com/services/facets/1.0&quot;>
  &lt;!-- Nesting level 1: implied variable ?s1 -->
  &lt;class iri=&quot;http://schema.org/Business&quot; />
  &lt;property iri=&quot;http://schema.org/makesOffer&quot;>
    &lt;!-- Nesting level 2: implied variable ?s2 -->
    &lt;property iri=&quot;http://schema.org/businessFunction&quot;>
      &lt;!-- Nesting level 3.1: implied variable ?s3 -->
      &lt;value datatype=&quot;uri&quot;>http://purl.org/goodrelations/v1#Dispose&lt;/value>
    &lt;/property>
    &lt;property iri=&quot;http://schema.org/itemOffered&quot;>
      &lt;!-- Nesting level 3.2: implied variable ?s4 -->
      &lt;class iri=&quot;http://schema.org/Product&quot; />
      &lt;property iri=&quot;http://schema.org/material&quot;>
        &lt;!-- Nesting level 4: implied variable ?s5 -->
        &lt;value>&quot;asbestos&quot;&lt;/value>
      &lt;/property>
    &lt;/property>
  &lt;/property>
  &lt;view type=&quot;list&quot; limit=&quot;100&quot; />
&lt;/query>
</code></pre>
<p><strong>Query meta graph</strong></p>
<p><img src="img/meta-graph-3.png" alt="meta-graph-3"></p>
<p><strong>Generated SPARQL query</strong></p>
<pre class="prettyprint source"><code>select ?s1 as ?c1  where  {
  ?s1 a &lt;http://schema.org/Business> . 
  ?s1 &lt;http://schema.org/makesOffer> ?s2 . 
  ?s2 &lt;http://schema.org/businessFunction> ?s3 . 
  filter (?s3 = &lt;http://purl.org/goodrelations/v1#Dispose>) . 
  ?s2 &lt;http://schema.org/itemOffered> ?s4 .
  ?s4 a &lt;http://schema.org/Product> . 
  ?s4 &lt;http://schema.org/material> ?s5 . 
  filter (?s5 = &quot;asbestos&quot;) . 
} 
group by (?s1) 
order by desc (&lt;LONG::IRI_RANK> (?s1))  
limit 100 
</code></pre>
<h2>DTD for Facet Service Input XML</h2>
<pre class="prettyprint source"><code>&lt;!ELEMENT query (text?,class*,property*,property-of*,value?,view?,cond?)>

&lt;!ELEMENT text (#PCDATA)>

&lt;!ELEMENT class EMPTY>

&lt;!ELEMENT property (class*|property*|property-of*|value?|view?)>

&lt;!ELEMENT property-of (class*|property*|property-of*|value?|view?)>

&lt;!ELEMENT value (#PCDATA)>

&lt;!-- 
When element &lt;value> occurs as a child of property-of, it 
must be datatype 'uri' (xsd:anyURI). The subject of the property to 
which 'property-of' refers must be an entity (a resource), not a 
literal; so the value's type must be 'uri'. This element has the 
effect of constraining the entity's URI to the specified value.
-->

&lt;!ELEMENT view EMPTY>

&lt;!-- 
Element &lt;view> may occur as a child of a &lt;query>, &lt;property> or 
&lt;property-of> element but may occur only once in the document.
&lt;view> specifies which subject is presented in the result set.
-->

&lt;!ATTLIST query
  graph CDATA #IMPLIED
  timeout CDATA #IMPLIED
  inference CDATA #IMPLIED
  same-as CDATA #IMPLIED
>

&lt;!ATTLIST view
  type (classes|geo|geo-list|list|list-count|
        properties|properties-in|propval-list|text|text-d|text-properties) #REQUIRED
  limit CDATA #IMPLIED
  offset CDATA #IMPLIED
>

&lt;!ATTLIST text
  property CDATA #IMPLIED
>

&lt;!ATTLIST text-d
  property CDATA #IMPLIED
>

&lt;!ATTLIST class
  iri CDATA #IMPLIED
  exclude yes #IMPLIED
  inference CDATA #IMPLIED
>

&lt;!ATTLIST property
  iri CDATA #REQUIRED
  same_as yes #IMPLIED
  inference CDATA #IMPLIED
>

&lt;!ATTLIST property-of
  iri CDATA #REQUIRED
  same_as yes #IMPLIED
  inference CDATA #IMPLIED
>

&lt;!--
 -- value and cond perform similar functions.
 -->

&lt;!ATTLIST value
  datatype CDATA #IMPLIED
  xml:lang CDATA #IMPLIED
  op (=|&lt;|>|&lt;=|>=) &quot;=&quot;
>

&lt;!ATTLIST cond
  datatype CDATA #IMPLIED
  xml:lang CDATA #IMPLIED
  op (=|&lt;|>|&lt;=|>=) &quot;=&quot;
  neg 1 #IMPLIED
>
</code></pre></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="FctError.html">FctError</a></li><li><a href="FctQuery.html">FctQuery</a></li><li><a href="FctResult.html">FctResult</a></li><li><a href="JXON.html">JXON</a></li></ul><h3>Global</h3><ul><li><a href="global.html#DESCRIBE_DFLT_SVC_ENDPOINT">DESCRIBE_DFLT_SVC_ENDPOINT</a></li><li><a href="global.html#FCT_QRY_AJAX_TIMEOUT">FCT_QRY_AJAX_TIMEOUT</a></li><li><a href="global.html#FCT_QRY_DFLT_SVC_ENDPOINT">FCT_QRY_DFLT_SVC_ENDPOINT</a></li><li><a href="global.html#FCT_QRY_DFLT_VIEW_LIMIT">FCT_QRY_DFLT_VIEW_LIMIT</a></li><li><a href="global.html#FCT_QRY_DFLT_VIEW_TYPE">FCT_QRY_DFLT_VIEW_TYPE</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Tue Feb 09 2021 16:13:10 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>